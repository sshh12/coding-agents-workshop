{% extends "base.html" %}

{% block title %}{{ experiment.name }} - ML Experiment Tracker{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="/">Dashboard</a> &gt; {{ experiment.name }}
</div>

<h1>{{ experiment.name }}</h1>
<div class="meta">
    {{ experiment.status_badge | safe }} &middot;
    Created {{ experiment.created_at }} &middot;
    Updated {{ experiment.updated_at }}
</div>

{% if experiment.description %}
<p class="description">{{ experiment.description }}</p>
{% endif %}

<!-- Tags -->
<div style="margin-bottom: 20px;">
    <h3>Tags</h3>
    {% if experiment.tags %}
        {% for tag in experiment.tags %}
            <span style="background-color: #e9ecef; padding: 2px 8px; border-radius: 12px; font-size: 0.85em; margin-right: 4px;">{{ tag.name }}</span>
        {% endfor %}
    {% else %}
        <p style="color: #6c757d;">No tags yet. Add tags via POST /api/experiments/{{ experiment.id }}/tags</p>
    {% endif %}
</div>

<div class="actions">
    <a href="/experiments/{{ experiment.id }}/compare" class="btn">Compare Runs</a>
</div>

<div class="card">
    <h2>Runs</h2>
    {% if runs %}
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Accuracy</th>
                <th>Loss</th>
                <th>Latency</th>
                <th>Created</th>
            </tr>
        </thead>
        <tbody>
            {% for run in runs %}
            <tr>
                <td>{{ run.name }}</td>
                <td>{{ run.status_badge | safe }}</td>
                <td>{{ run.accuracy_fmt }}</td>
                <td>{{ run.loss_fmt }}</td>
                <td>{{ run.latency_fmt }}</td>
                <td>{{ run.created_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">No runs yet. Log a run via POST /api/experiments/{{ experiment.id }}/runs</div>
    {% endif %}
</div>

{% if runs %}
<div class="card">
    <h2>Metrics</h2>
    <div class="chart-container" style="height: 300px;">
        <canvas id="metricsChart"></canvas>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
{% if runs %}
<script>
    const labels = {{ run_labels | safe }};
    const accuracies = {{ run_accuracies | safe }};
    const losses = {{ run_losses | safe }};

    new Chart(document.getElementById('metricsChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Accuracy',
                    data: accuracies,
                    borderColor: 'rgba(13, 110, 253, 1)',
                    backgroundColor: 'rgba(13, 110, 253, 0.1)',
                    fill: true,
                    tension: 0.3,
                },
                {
                    label: 'Loss',
                    data: losses,
                    borderColor: 'rgba(220, 53, 69, 1)',
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    fill: true,
                    tension: 0.3,
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true } }
        }
    });
</script>
{% endif %}
{% endblock %}
